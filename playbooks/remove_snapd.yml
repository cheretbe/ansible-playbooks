---

- hosts: all
  tasks:

    - name: Remove snapd apt package
      ansible.builtin.apt:
        name: snapd
        state: absent
        autoremove: true
        purge: true
      become: true

    # https://askubuntu.com/questions/1345385/how-can-i-stop-apt-from-installing-snap-packages/1345401#1345401
    - name: Disable snapd package installation
      ansible.builtin.copy:
        content: |
          # Generated by Ansible at {{ lookup('pipe', 'hostname -f') }}
          # Any changes made here will be overwritten

          # To prevent repository packages from triggering the installation of Snap,
          # this file forbids snapd from being installed by APT.
          # For more information: https://linuxmint-user-guide.readthedocs.io/en/latest/snap.html

          Package: snapd
          Pin: release a=*
          Pin-Priority: -10
        dest: /etc/apt/preferences.d/nosnap.pref
        owner: root
        group: root
        mode: 0640
      become: true
