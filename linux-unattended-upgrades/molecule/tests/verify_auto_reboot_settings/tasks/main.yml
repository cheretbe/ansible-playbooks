---
- name: Verify that reboot is enabled in apt config
  lineinfile:
    name: /etc/apt/apt.conf.d/90-ansible-unattended-upgrades
    line: 'Unattended-Upgrade::Automatic-Reboot "true";'
    state: present
  check_mode: yes
  register: apt_line
  failed_when: (apt_line is changed) or (apt_line is failed)
  when: ansible_os_family == "Debian" and molecule_test_auto_reboot

- name: Verify that reboot is disabled in apt config
  lineinfile:
    name: /etc/apt/apt.conf.d/90-ansible-unattended-upgrades
    line: 'Unattended-Upgrade::Automatic-Reboot "true";'
    state: absent
  check_mode: yes
  register: apt_line
  failed_when: (apt_line is changed) or (apt_line is failed)
  when: ansible_os_family == "Debian" and (not molecule_test_auto_reboot)

- name: Get cron file info
  stat:
    path: /etc/cron.d/ansible_unattended_upgrade_reboot
  register: cron_file_info

- name: Verify that cron file is present
  assert:
    that:
      - cron_file_info.stat.exists
  when: ansible_os_family == "RedHat" and molecule_test_auto_reboot

- name: Verify that cron file is absent
  assert:
    that:
      - not cron_file_info.stat.exists
  when: >-
    (ansible_os_family == "Debian")
    or
    (ansible_os_family == "RedHat" and (not molecule_test_auto_reboot))
